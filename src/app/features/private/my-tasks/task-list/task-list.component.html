<div class="task-panel">
  <h1>
    @if (activityListType() === ActivityListView.Habits) {
      My Habits
    } @else {
      @if (activityListType() === ActivityListView.Activities) {
        My Activities
      } @else {
        My Tasks
      }
    }

    <div class="creation-panel">
      <button class="task-create" nz-button (click)="onTaskCreation()">
        Create New Task
      </button>
      <button class="habit-create" nz-button (click)="onHabitCreation()">
        Create New Habit
      </button>
    </div>
  </h1>

  <div class="task-layout">
    <app-task-filter
      [listView]="activityListType"
      [categoryId]="categoryId"
      [difficultyId]="difficultyId"
      [isAlive]="isAlive"
    ></app-task-filter>

    <div class="task-list">
      @if (!loading && activities.length === 0) {
        @if (activityListType() === ActivityListView.Habits) {
          <div class="empty-state">
            <h3>You have no habits yet!</h3>
          </div>
        } @else {
          @if (activityListType() === ActivityListView.Activities) {
            <div class="empty-state">
              <h3>You have no activities yet!</h3>
            </div>
          } @else {
            <div class="empty-state">
              <h3>You have no tasks yet!</h3>
            </div>
          }
        }
      }

      @if (!loading && activities.length > 0) {
        @for (date of getGroupKeys(); track getGroupKeys().keys()) {
          <div class="task-group">
            <h3 class="task-group-title">{{ date }}</h3>

            <div class="tasks-grid">
              @for (activity of groupedTasks[date]; track activity.id) {
                <app-activity-item
                  [activity]="activity"
                  (editActivity)="onActivityEdit($event)"
                  (activityUpdated)="onActivityUpdated($event)"
                >
                </app-activity-item>
              }
            </div>
          </div>
        }
      }
    </div>
    @if (editionMode!() || creationMode!()) {
      <app-task-form
        [activity]="selectedActivity()"
        [viewMode]="viewMode()"
        [editionMode]="editionMode!()"
        [creationMode]="creationMode!()"
        (activityFormSubmitted)="onTaskSubmit()"
        (activityDeleted)="onTaskDelete()"
        (closeForm)="onFormClose()"
        [type]="formType()"
      >
      </app-task-form>
    } @else {
      <app-task-calendar
        #calendarComponent
        (deadlineSelected)="endDate.set($event)"
        (deadlineSelected)="startDate.set($event)"
      >
      </app-task-calendar>
    }
  </div>
</div>
