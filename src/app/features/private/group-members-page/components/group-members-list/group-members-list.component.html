<nz-table
  #memberTable
  [nzData]="paginatedMembers()"
  [nzLoading]="loading()"
  [nzShowPagination]="false"
>
  <thead>
    <tr>
      <th>Username</th>
      <th>Group Money</th>
      <th>Total Earned</th>
      <th>Joined At</th>
      <th nzWidth="200px">Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let member of memberTable.data">
      <td>
        <strong>{{ member.username }}</strong>
        <span *ngIf="member.userId === adminId()" class="admin-badge">
          <span
            nz-icon
            nzType="crown"
            nzTheme="twotone"
            [nzTwotoneColor]="'var(--color-warning)'"
          ></span>
          Admin
        </span>
      </td>
      <td>
        <span class="money-value">
          {{ member.groupMoney ?? 0 | number: "1.2-2" }}
        </span>
      </td>
      <td>
        <span class="money-value earned">
          {{ member.totalEarnedMoney ?? 0 | number: "1.2-2" }}
        </span>
      </td>
      <td>{{ member.joinedAt | date: "short" }}</td>
      <td>
        <button
          nz-button
          nzType="link"
          nzSize="small"
          (click)="viewProfile(member)"
          nz-tooltip
          nzTooltipTitle="View Profile"
        >
          <span nz-icon nzType="user"></span>
        </button>
        <button
          nz-button
          nzType="link"
          nzSize="small"
          (click)="openEditModal(member)"
          [disabled]="!isAdmin()"
          nz-tooltip
          nzTooltipTitle="Edit Member"
        >
          <span nz-icon nzType="edit"></span>
        </button>
        <button
          nz-button
          nzType="link"
          nzSize="small"
          (click)="showMemberInventory(member)"
          [disabled]="!isAdmin()"
          nz-tooltip
          nzTooltipTitle="Show inventory"
        >
          <span nz-icon nzType="skin"></span>
        </button>
        <button
          nz-button
          nzType="link"
          nzDanger
          nzSize="small"
          (click)="confirmRemove(member)"
          [disabled]="!isAdmin() || member.userId === adminId()"
          nz-tooltip
          nzTooltipTitle="Remove Member"
        >
          <span nz-icon nzType="delete"></span>
        </button>
      </td>
    </tr>
  </tbody>
</nz-table>

<div class="pagination-container" *ngIf="totalPages() > 0">
  <app-pagination-more
    [maxPageIndex]="totalPages()"
    (pageChange)="onPageChange($event)"
  ></app-pagination-more>
</div>

<app-edit-group-member-form
  [groupId]="groupId()"
  [member]="selectedMember()"
  (memberUpdated)="onMemberUpdated()"
></app-edit-group-member-form>

@if (selectedMember()) {
  <app-group-member-inventory
    [groupId]="groupId()"
    [member]="selectedMember()!"
    [mode]="GroupPreviewMode.ADMIN"
  ></app-group-member-inventory>
}
